@using Microsoft.AspNetCore.Mvc.TagHelpers
@using WorkshopManager.Interfaces
@model WorkshopManager.DTOs.ServiceOrderDto
@inject ITaskService     TaskSvc
@inject IUsedPartService PartSvc

@{
    var tasks = await TaskSvc.ListAsync(Model.Id);
    var parts = await PartSvc.ListAsync(Model.Id);
    var sumTasks = tasks.Sum(t => t.Price);
    var sumParts = parts.Sum(p => p.Quantity * p.UnitPrice);
    var total = sumTasks + sumParts;
}

<h3>Zlecenie #@Model.Id – @Model.Status</h3>

<p><b>Klient:</b> @Model.CustomerName<br/>
    <b>Pojazd:</b> @Model.VehicleReg</p>

<h4>Zadania</h4>
<table class="table">
    <thead><tr><th>Opis</th><th class="text-end">Cena</th><th></th></tr></thead>
    <tbody>
    @foreach (var t in tasks) {
        <partial name="_TaskRow" model="t"/>
    }
    </tbody>
    <tfoot>
    <tr><th class="text-end">Robocizna:</th><th class="text-end">@sumTasks:C</th><th></th></tr>
    </tfoot>
</table>

<h4>Części</h4>
<table class="table">
    <thead>
    <tr><th>Nazwa</th><th class="text-end">Ilość</th><th class="text-end">Cena szt.</th><th class="text-end">Razem</th><th></th></tr>
    </thead>
    <tbody>
    @foreach (var p in parts) {
        <partial name="_UsedPartRow" model="p"/>
    }
    </tbody>
    <tfoot>
    <tr><th colspan="3" class="text-end">Części:</th><th class="text-end">@sumParts:C</th><th></th></tr>
    <tr class="table-secondary"><th colspan="3" class="text-end">Łącznie:</th><th class="text-end">@total:C</th><th></th></tr>
    </tfoot>
</table>

<a asp-action="Index" class="btn btn-secondary">← Powrót</a>
